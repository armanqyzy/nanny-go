<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–π—Ç–∏ | Nanny Platform</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="background">
    <div class="form-card">
        <h2>üêæ –í–û–ô–¢–ò</h2>

        <div id="error-box" class="error-box"></div>

        <form id="loginForm">
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button type="submit">–í–û–ô–¢–ò</button>
        </form>

        <p class="switch-text">
            –ï—â—ë –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã?
            <a href="/register">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</a>
        </p>
    </div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const errorBox = document.getElementById('error-box');
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                localStorage.setItem('user', JSON.stringify({
                    id: result.user_id,
                    role: result.role,
                    email: data.email
                }));

                // –†–µ–¥–∏—Ä–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                if (result.role === 'admin') {
                    window.location.href = '/admin-dashboard.html';
                } else if (result.role === 'sitter') {
                    window.location.href = '/sitter-dashboard.html';
                } else {
                    window.location.href = '/dashboard.html';
                }
            } else {
                errorBox.style.display = 'block';
                errorBox.innerText = result.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
            }
        } catch (err) {
            errorBox.style.display = 'block';
            errorBox.innerText = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
        }
    });
</script>
</body>
</html>
