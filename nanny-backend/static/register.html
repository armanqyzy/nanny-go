<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Создать аккаунт | Nanny</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="background">
    <img src="/static/logo.png" class="logo" alt="Nanny Logo">
    <img src="/static/paws.png" class="paws" alt="Paws">

    <div class="form-card">
        <h2>СОЗДАТЬ АККАУНТ</h2>

        <!-- окно для ошибок -->
        <div id="error-box" class="error-box"></div>

        <form id="registerForm">
            <input type="text" name="full_name" placeholder="Полное имя" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="text" name="phone" placeholder="Номер телефона" required>
            <input type="password" name="password" placeholder="Пароль" required>

            <p class="role-label">ВЫБЕРИТЕ РОЛЬ</p>
            <div class="role-buttons">
                <label><input type="radio" name="role" value="owner" required> ВЛАДЕЛЕЦ</label>
                <label><input type="radio" name="role" value="sitter" required> ПЕТ-СИТТЕР</label>
            </div>

            <button type="submit">ЗАРЕГИСТРИРОВАТЬСЯ</button>
        </form>

        <p class="switch-text">
            Уже есть аккаунт? <a href="/login">ВОЙТИ</a>
        </p>
    </div>

    <div class="bottom-animals">
        <img src="/static/cat.png" class="cat" alt="Cat">
        <img src="/static/dogs.png" class="dogs" alt="Dogs">
    </div>
</div>

<!-- === JS === -->
<script>
    // === ЗАПРЕТ ПРОБЕЛОВ В ПАРОЛЕ ===
    document.querySelector('input[name="password"]').addEventListener('keydown', function(e) {
        if (e.key === ' ' || e.code === 'Space') {
            e.preventDefault();
        }
    });

    // Также на случай вставки текста
    document.querySelector('input[name="password"]').addEventListener('input', function(e) {
        this.value = this.value.replace(/\s/g, '');
    });

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        const password = data.password;
        const errorBox = document.getElementById("error-box");

        // === ВАЛИДАЦИЯ ПАРОЛЯ ===
        const hasNumber = /[0-9]/.test(password);
        const hasUppercase = /[A-ZА-Я]/.test(password);
        const isLongEnough = password.length >= 8;

        if (!hasNumber || !hasUppercase || !isLongEnough) {
            errorBox.style.display = "block";
            errorBox.innerText = "Пароль должен быть не короче 8 символов, содержать хотя бы одну цифру и одну заглавную букву.";
            return;
        } else {
            errorBox.style.display = "none";
        }

        // === ВЫБОР ЭНДПОИНТА ===
        const endpoint = data.role === 'owner' ? '/register/owner' : '/register/sitter';

        try {
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                alert(result.message);
                window.location.href = '/login';
            } else {
                errorBox.style.display = "block";
                errorBox.innerText = "Ошибка: " + (result.error || "неизвестная ошибка");
            }
        } catch (err) {
            errorBox.style.display = "block";
            errorBox.innerText = "Ошибка соединения с сервером.";
        }
    });
</script>
</body>
</html>